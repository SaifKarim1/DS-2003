---
course: "DS 2003: Communicating with Data"
class: "14"
title: "Linear Regression Lab"
output: html_notebook
---

## Fish Dataset
This dataset is a record of 7 common different fish species in fish market sales.


```{r}
# import packages
library(ggplot2)
library(ggpubr) 
library(paletteer)
library(GGally)
```

```{r}
# import data & examine
df <- read.csv('fish.csv')
str(df)
```

```{r}
head(df)
```
## Problem #1

**Create a frequency chart for species in the dataset**
* chart should be ordered from greatest count to lowest count
* Use color element and label appropiately

```{r}
ggplot(df, aes(x=reorder(Species, Species, function(x)-length(x)), fill = Species)) +
  geom_bar() +
  xlab('Species') +
  ylab('Count') +
  scale_color_paletteer_d(nord, aurora) + 
  theme_minimal()
        
```


**Your dependent variable for this lab will be `Weight`**

## Problem 2

**Without dregging the data, write a research question that can be answered using a simple linear regression**

```{r}
# How much does the length of a fish species explain its weight?
```

**What is your independent variable?**
```{r}
# Length2
```

## Problem 3

**Create a pair plot of the numeric columns**

```{r}
ggpairs(df, columns = 2:7, progress = FALSE, ggplot2::aes(colour = Species)) 
```


### Problem #3

**Evaluate your dependent variable**

```{r}
# check distribution visually
hist(df$Weight, breaks = 10)
```

```{r}
# use statistical test to check for normal distribution
shapiro.test(df$Weight)
```
## Problem 4

**Conduct an outlier analysis**

```{r}
ggplot(df, aes(Weight)) +
  geom_boxplot()
```
```{r}
outlier <- function(data) {
   q75 <- quantile(data, probs = 0.75, na.rm = TRUE)
   q25 <- quantile(data, probs = 0.25, na.rm = TRUE)
   iqr <- q75 - q25
   threshold_upper <- (iqr * 1.5) + q75
   data > threshold_upper 
}
```

```{r}
df[rowSums(sapply(df, outlier), na.rm = TRUE) > 0, ]
```


## Problem 3

**Evaluate your independent variable**

```{r}
# check for linearity
ggplot(df, aes(Length2, Weight)) +
  geom_point()
```
`


## Problem 4

**Run a simple linear regression model**
```{r}
m1 <- lm(Weight ~ Length2, data = df)

summary(m1)
```

```{r}
par(mfrow=c(2,2)) 

plot(m1)

par(mfrow=c(1,1)) 
```


## Problem 5

**Interpret your results**

```{r}
# A one unit increase in weight is associated with a 0.004 unit increase in width of the fish (p<0.001). 
# However, the scatter plot and the residual analysis tells us an OLS linear model may not be the most suitable
```

## Problem 6

**Visualize your results**

```{r}
m1.graph<-ggplot(df, aes(Length2, Weight))+
  geom_point() + # add data points
  geom_smooth(method = "lm", col = "black") + # add regression line
  stat_regline_equation(label.x = 30, label.y = 2.5) + # add equation
  theme_minimal() +
  labs(title = "Fish width as a function of weight",
      x = "Width",
      y = "Weight")

m1.graph
```

## Problem 7

**What are some thoughts your have about this graph?**

```{r}

```

## Problem 8

**Develop a question from this dataset that is suited for multiple linear regression**

```{r}
# How much does fish length and height explain fish weight?
```

## Problem 9

**Evaluate you independent variables**

```{r}
cor(df$Length2, df$Height)
```
```{r}
m2 <- lm(Weight ~ Length2 + Height, data = df)

summary(m2)
```

```{r}
par(mfrow=c(2,2))
plot(m2)
par(mfrow=c(1,1))
```

## Problem

**Interpret your results**
```{r}

```

## Problem

**Graph your results**
* make point size relative to 2nd independent variable
* add regression lines for each species (hint: can do in geom_smooth)

```{r}
m1.graph <- ggplot(df, aes(Length2, Weight, size = Height, color = Species))+
  geom_point(alpha = 0.6) + # add data points
  geom_smooth(data = df, method = "lm", aes(color = Species)) + # add regression line
  theme_minimal() +
  labs(title = "1",
      x = "Width",
      y = "Weight")

m1.graph
```

## Problem

**What does including species tell us?**

```{r}

```

