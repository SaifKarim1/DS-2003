---
title: "DS2003: Interactive Plots in plotly"
author: "Natalie Kupperman"
week: 9
class: 17
---
## Plotly

* `plotly` is a high-level interface to [plotly.js](https://github.com/plotly/plotly.js), based on [d3.js](https://d3js.org/) which provides an easy-to-use UI to generate slick D3 interactive graphics.

* Plot work in multiple formats: viewer windows, R Markdown documents, shiny apps

* plotly is also backed by a strong community and active development

* plotly works with R, python, excel, and others. We will just focus on R in this class.  

### Why use interactive graphics?
  - Zooming
  - Silencing
  - Hovering
  - Sliding
  - Filtering
  
### plot_ly Resources

- [The Plolty Website](https://plotly.com/)
- [The Plotly R documentation](https://plotly.com/r/)
- [The Plotly R Package on GitHub](https://github.com/plotly/plotly.R)
- [The Plotly R Cheatsheet](https://images.plot.ly/plotly-documentation/images/r_cheat_sheet.pdf)

```{r}
library(tidyverse)
library(plotly)
```

```{r}
# read in 'wine.csv' data
wine <- read.csv('wine.csv')

head(wine)
```
Let's look at a static graph comparing `flavanoids` to `proline`

```{r}
static_plot <- wine %>%
  mutate(Type = factor(Type)) %>%
  ggplot(aes(Flavanoids, Proline, color = Type)) +
  geom_point() +
  theme_minimal() +
  scale_color_manual(values = c("#00AFBB", "#E7B800", "#FC4E07"))

static_plot
```

### How to create a plotly object

- There are two main approaches to initialize a plotly object:  
  
   + transforming a ggplot2 object with `ggplotly()` 
   + setting up aesthetics mappings with `plot_ly()` directly

## Today's focus `ggplotly()

- `ggplotly()` takes existing `ggplot2` objects and converts them into interactive `plotly` graphics. That is, `ggplotly()` converts your static plots to an interactive web-based version!

- This makes it easy to create interactive figures because we are already familiar to the `ggplot2` syntax.

```{r}
# Create an interactive plot of Flavonoids vs Proline

ggplotly(static_plot)
```
### Notes
Interactive plots are great!
* Bad Design = Bad Interactive Plots
* Follow data-viz best practices

### Bar Plot

```{r}
g <- ggplot(data = wine, aes(x = Type, fill = Type)) + 
     geom_bar(fill = c("#00AFBB", "#E7B800", "#FC4E07")) +
     theme_classic() 

ggplotly(g)
```

### Histogram

```{r}
g2 <- ggplot(wine, aes(x = Flavanoids, fill = as.factor(Type))) + 
      geom_histogram(bins = 15, alpha = 0.6) +
      theme_minimal() +
      scale_fill_manual(values = c("#00AFBB", "#E7B800", "#FC4E07")) 

ggplotly(g2)
```

### Scatterplot

```{r}
g4 <- ggplot(wine, aes(x = Flavanoids, y = Proline, color = as.factor(Type))) + 
      geom_point() + 
      geom_smooth(method="loess", formula=y~x, se=F) + 
      scale_color_manual(values = c("#00AFBB", "#E7B800", "#FC4E07"), name = 'Type') +
      theme_bw() 

ggplotly(g4)
```
```{r}
g5 <- ggplot(wine, aes(x = Flavanoids, y = Proline, color = as.factor(Type))) + 
      geom_point() + 
      geom_smooth(method="lm", formula=y~x, se=F) + 
      scale_color_manual(values = c("#00AFBB", "#E7B800", "#FC4E07"), name = 'Type') +
      theme_bw()

ggplotly(g5)
```



## Using plotly without ggplot2




### Bar plot

- Specify `type = "bar"` to create a bar plot.

- More info from https://plotly.com/r/bar-charts/; https://plotly.com/r/reference/#bar

```{r}
occ_counted <- incex %>% count(occ, name = 'count') 
occ_counted

plot_ly(occ_counted, x= ~occ, y=~count, type = "bar")
```

- Add hover texts to a bar plot, and produce red bars with black outline.

```{r}
occ_counted$text <- c("low level", "medium level", "high level")

p<- plot_ly(occ_counted, x= ~occ, y=~count, type = "bar", 
             text = ~text, 
              color = I("skyblue"), 
              stroke = I("red"), 
              span = I(10))
p
```

```{r}
# change title, xlabel, and ylabel
p %>% layout(title = "Freq. of Occupation Status",
         xaxis = list(title = "Occupation Status"),
         yaxis = list(title = "Frequency"))
```

### Boxplot

- Specify `type = "box"` to create a boxplot.

- More info from https://plotly.com/r/box-plots/

```{r}
plot_ly(incex, y = ~income, type = "box", name = '')
```

- create grouped boxplots.

```{r}
?airmiles
plot_ly(incex, y = ~income, color = ~occ, type = "box")
```

### Histogram

- Use the `type = "histogram"` argument.

- More info from https://plotly.com/r/histograms/

```{r}
plot_ly(incex, x = ~income, type = "histogram")
```

### Scatterplot

- Specify a scatterplot by indicating `type = "scatter"` and `mode = "markers"`.

- More info from https://plotly.com/r/line-and-scatter/; https://plotly.com/r/reference/#scatter; https://plotly.com/r/reference/#scatter-mode

```{r}
plot_ly(incex, x = ~income, y = ~age, type = "scatter", mode = "markers")
```

#### Scatterplot with different colors

- Add color to your scatterplot points according to a categorical variable in the data frame you use with `plot_ly()`.

```{r}
plot_ly(incex, x = ~income, y = ~age, type = "scatter", mode = "markers",
        color = ~edu)
```

- You may want to change a color brewer palette.

```{r}
plot_ly(incex, x = ~income, y = ~age, type = "scatter", mode = "markers",
        color = ~edu, colors = "Set1")
```

#### Scatterplot with different symbols

- Create a subset of incex data. Change symbols for educational status.

```{r}
set.seed(1)
index <- sample(1:nrow(incex), 100, replace=FALSE)

subincex <- incex[index, ]
plot_ly(subincex, x = ~income, y = ~age, type = "scatter", mode = "markers",
        symbol = ~edu, 
        symbols = c('circle','x','o'), 
        color = I('black'), 
        marker = list(size = 10))
```

### 3D Scatterplot

- Create a three-dimensional scatterplot with the `type = "scatter3d"` argument. If you click and drag these scatterplots, you can view them from different angles.

```{r}
plot_ly(subincex, x = ~income, y = ~age, z= ~oexp, type = "scatter3d", mode = "markers", color = ~oexp, name="")
```

### Lineplot

- Specify a scatterplot by indicating `type = "scatter"` and `mode = "lines"`.

- More info from https://plotly.com/r/line-charts/; https://plotly.com/r/reference/#scatter; https://plotly.com/r/reference/#scatter-mode 

- Line graphs are useful for showing change over time. 

- For demonstration, use `airmiles` data that is time series data. 


```{r}
data("airmiles") # load airmiles data
str(airmiles) # check structure

plot_ly(x = time(airmiles), y = airmiles, type = 'scatter', mode = 'lines')
```

